<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Produit Bobinette TPE -->
        <record id="product_bobinette_tpe" model="product.template">
            <field name="name">Bobinette 57x57x10</field>
            <field name="type">consu</field>
            <field name="detailed_type">consu</field>
            <field name="image_1920" type="base64" file="waf_so4/data/img/bobinette.png"/>
            
            <!-- Informations produit -->
            <field name="default_code">BOB57X57X10</field>
            <field name="barcode">BOB57X57X10</field>
            <field name="categ_id" ref="product.product_category_all"/>
            
            <!-- Prix -->
            <field name="list_price">6.25</field>
            <field name="standard_price">6.25</field>
            
            <!-- Unités de mesure -->
            <field name="uom_id" ref="uom.product_uom_unit"/>
            <field name="uom_po_id" ref="uom.product_uom_unit"/>
            
            <!-- Configuration -->
            <field name="active" eval="True"/>
            <field name="sale_ok" eval="True"/>
            <field name="purchase_ok" eval="True"/>
            <field name="tracking">none</field>
            
            <!-- Configuration de stock -->
            <field name="responsible_id" ref="base.user_admin"/>
            <field name="weight">0.001</field>
            <field name="route_ids" eval="[(5, 0, 0)]"/>
            <field name="reordering_min_qty">0</field>
            <field name="reordering_max_qty">0</field>

            <!-- Configuration des taxes -->
            <field name="taxes_id" eval="[(6, 0, [ref('waf_so4.tax_vat_sale_20')])]"/>
            
            <!-- Description -->
            <field name="description" type="html">
                <p>Bobinette TPE</p>
                <ul>
                    <li>Bobinette 57x57x10</li>
                    <li>Imprimante thermique intégrée</li>
                    <li>Move 5000 Bluetooth CLESS</li>
                </ul>
            </field>
        </record>

        <!-- Stock initial -->
        <record id="stock_move_in_initial" model="stock.move">
            <field name="name">Stock initial Bobinette</field>
            <field name="product_id" model="product.product" search="[('product_tmpl_id', '=', ref('product_bobinette_tpe'))]"/>
            <field name="product_uom" ref="uom.product_uom_unit"/>
            <field name="product_uom_qty">100</field>
            <field name="location_id" ref="stock.stock_location_suppliers"/>
            <field name="location_dest_id" ref="stock.stock_location_stock"/>
            <field name="state">draft</field>
        </record>

        <!-- Ligne de mouvement avec quantité réalisée -->
        <record id="stock_move_line_in_initial" model="stock.move.line">
            <field name="move_id" ref="stock_move_in_initial"/>
            <field name="product_id" model="product.product" search="[('product_tmpl_id', '=', ref('product_bobinette_tpe'))]"/>
            <field name="product_uom_id" ref="uom.product_uom_unit"/>
            <field name="quantity">100</field>
            <field name="location_id" ref="stock.stock_location_suppliers"/>
            <field name="location_dest_id" ref="stock.stock_location_stock"/>
        </record>

        <!-- Confirmer et valider le mouvement initial -->
        <function model="stock.move" name="_action_confirm">
            <value eval="[ref('stock_move_in_initial')]"/>
        </function>

        <function model="stock.move" name="_action_done">
            <value eval="[ref('stock_move_in_initial')]"/>
        </function>

        <!-- Désactiver explicitement les règles de réapprovisionnement existantes -->
        <record id="disable_reordering_rules" model="ir.model.data">
            <field name="name">disable_reordering_rules_bobinette</field>
            <field name="model">stock.warehouse.orderpoint</field>
            <field name="module">waf_so4</field>
            <field name="res_id" eval="False"/>
            <field name="noupdate" eval="True"/>
        </record>
    </data>
</odoo>
