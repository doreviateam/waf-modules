<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Action Window -->
    <record id="action_pre_sale_order_line_delivery" model="ir.actions.act_window">
        <field name="name">Planifier les livraisons</field>
        <field name="res_model">pre.sale.order.line.delivery</field>
        <field name="view_mode">kanban,calendar,tree,form</field>
        <field name="context">{
            'search_default_upcoming': 1,
            'search_default_group_by_date': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Aucune livraison planifiée
            </p>
            <p>
                Planifiez vos livraisons en spécifiant la date, l'heure et l'adresse de livraison.
            </p>
        </field>
    </record>

    <!-- Action pour les commandes à planifier -->
    <record id="action_sale_order_to_plan" model="ir.actions.act_window">
        <field name="name">Commandes à planifier</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_preso', '=', True)]</field>
        <field name="context">{
            'search_default_to_plan': 1,
            'search_default_my_sale_orders_filter': 1
        }</field>
        <field name="search_view_id" ref="sale.view_sales_order_filter"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Aucune commande à planifier
            </p>
            <p>
                Créez une commande et activez la planification des livraisons
            </p>
        </field>
    </record>

    <!-- Menu racine -->
    <menuitem id="menu_preso_root"
              name="Vente"
              parent="watergile_partner.menu_watergile_root"
              sequence="1"/>

    <!-- Sous-menus -->
    <menuitem id="menu_preso_orders"
              name="Commandes"
              parent="menu_preso_root"
              sequence="10">
        <menuitem id="menu_preso_orders_to_plan"
                  name="À planifier"
                  action="action_sale_order_to_plan"
                  sequence="1"/>
        <menuitem id="menu_preso_orders_all"
                  name="Toutes les commandes"
                  action="sale.action_orders"
                  sequence="2"/>
    </menuitem>

    <menuitem id="menu_preso_delivery"
              name="Livraisons"
              parent="menu_preso_root"
              sequence="20">
        <menuitem id="menu_preso_delivery_calendar"
                  name="Calendrier des livraisons"
                  action="action_pre_sale_order_line_delivery"
                  sequence="1"/>
    </menuitem>

    <menuitem id="menu_preso_product"
              name="Produits"
              parent="menu_preso_root"
              action="product.product_template_action_all"
              sequence="30"/>

    <!-- Vue recherche pour les livraisons -->
    <record id="view_pre_sale_order_line_delivery_search" model="ir.ui.view">
        <field name="name">pre.sale.order.line.delivery.search</field>
        <field name="model">pre.sale.order.line.delivery</field>
        <field name="arch" type="xml">
            <search>
                <field name="partner_id"/>
                <field name="product_id"/>
                <field name="delivery_date"/>
                <separator/>
                <filter string="À venir" name="upcoming"
                        domain="[('delivery_date', '>=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter string="Aujourd'hui" name="today"
                        domain="[('delivery_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <separator/>
                <filter string="Brouillon" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Confirmé" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                <filter string="Livré" name="done" domain="[('state', '=', 'done')]"/>
                <group expand="0" string="Regrouper par">
                    <filter string="Date" name="group_by_date" context="{'group_by': 'delivery_date'}"/>
                    <filter string="État" name="group_by_state" context="{'group_by': 'state'}"/>
                    <filter string="Client" name="group_by_partner" context="{'group_by': 'partner_id'}"/>
                </group>
            </search>
        </field>
    </record>
</odoo>
